{% sw_extends '@Storefront/storefront/element/cms-element-sidebar-filter.html.twig' %}
{% block element_sidebar_filter %}
 {% block base_breadcrumb %}
        {% sw_include '@Storefront/storefront/layout/breadcrumb.html.twig' with {
            context: context,
            category: page.product.seoCategory
        } only %}
    {% endblock %}
    {# Use values from cms data if context is a cmsPage, otherwise `listing` and `sidebar` must be set manually #}
    {% if cmsPage is defined %}
        {% set config = element.fieldConfig.elements %}
        {% set slot = cmsPage.firstElementOfType('product-listing') %}
        {% set listing = slot.data.listing %}
        {% set sidebar = block.sectionPosition == 'sidebar' %}
    {% endif %}

    {% if listing.aggregations.elements|length > 0 %}
 {% if (controllerName|lower == 'navigation' and controllerAction|lower == 'index') || (controllerName|lower == 'cms' and controllerAction|lower == 'category' )%}
            {% set breadcrumbCategories = sw_breadcrumb_full(page.header.navigation.active, context.context) %}
            {% set categoryId = category.id %}
            {% set breadcrumbKeys = breadcrumbCategories|keys %}
            {% if breadcrumbCategories|length > 0 %}
                {% if controllerName|lower  == 'navigation' and controllerAction|lower == 'index'  %}
                    <div class="row" style="width: 100%;">
                        <nav class="categorybreadcrumb" aria-label="breadcrumb">
                            <ol class="breadcrumb">
                                {% for breadcrumbCategory in breadcrumbCategories %}
                                    {% set key = breadcrumbCategory.id %}
                                    {% set name = breadcrumbCategory.translated.name %}
                                    <li class="breadcrumb-item"
                                        {% if key is same as(categoryId) %}aria-current="page"{% endif %}
                                        itemprop="itemListElement"
                                        itemscope
                                        itemtype="https://schema.org/ListItem">
                                        {% if breadcrumbCategory.type == 'folder' %}
                                            <div itemprop="item">
                                                <div itemprop="name">{{ name }}</div>
                                            </div>
                                        {% else %}
                                            <a href="{{ category_url(breadcrumbCategory) }}"
                                               class="breadcrumb-link {% if key is same as(categoryId) %} is-active{% endif %}"
                                               title="{{ name }}"
                                               {% if category_linknewtab(breadcrumbCategory) %}target="_blank"{% endif %}
                                               itemprop="item">
                                                <link itemprop="url"
                                                      href="{{ category_url(breadcrumbCategory) }}">
                                                <span class="breadcrumb-title" itemprop="name">{{ name }}</span>
                                            </a>
                                        {% endif %}
                                        <meta itemprop="position" content="{{ loop.index }}">
                                    </li>
                                    {% if key != breadcrumbKeys|last %}
                                        <div class="breadcrumb-placeholder">
                                            {% sw_icon 'arrow-medium-right' style { 'size': 'fluid', 'pack': 'solid'} %}
                                        </div>
                                    {% endif %}
                                {% endfor %}
                            </ol>
                        </nav>
                    </div>
                {% endif %}
            {% endif %}
        {% endif %}
        {% set owyListingCatHeading = page.header.navigation.active.translated.name %}
        {% if owyListingCatHeading %}
           <div class="filter-panel-heading">
                <h2>{{ owyListingCatHeading }} </h2>
            </div>


               {% if (controllerName|lower == 'navigation' and controllerAction|lower == 'index') || (controllerName|lower == 'cms' and controllerAction|lower == 'category' )%}
                   <div class="product-counts-box" id="filter-product-count"></div>
               {% endif %}

        {% endif %}

       

        <div class="cms-element-sidebar-filter">
            {% block element_product_listing_filter_button %}
                <button class="btn header-actions-btn filter-panel-wrapper-toggle"
                        type="button"
                        data-offcanvas-filter="true"
                        aria-haspopup="true"
                        aria-expanded="false"
                        aria-label="{{ "general.menuLink"|trans }}">
                    {% block element_product_listing_filter_button_icon %}
                        {% sw_icon 'sliders-horizontal' %}
                    {% endblock %}
                    {{ "listing.filterTitleText"|trans }}
                </button>
            {% endblock %}

            {% block element_sidebar_filter_panel %}
                 {{ parent() }}
            {% endblock %}
        </div>
    {% endif %}
{% endblock %}
