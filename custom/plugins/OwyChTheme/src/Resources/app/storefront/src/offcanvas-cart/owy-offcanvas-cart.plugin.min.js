import ViewportDetection from"src/helper/viewport-detection.helper";import OffCanvasCartPlugin from"src/plugin/offcanvas-cart/offcanvas-cart.plugin";import AjaxOffCanvas from"../offcanvas/ajax-offcanvas.plugin";export default class OwyCustomOffcanvasCart extends OffCanvasCartPlugin{init(){async function getWishlist(){const wishlistUrl=$("#wishlistUrl").val(),customerId=$("#customerId").val();await $.post(wishlistUrl,{customerId:customerId},(function(data){if(data.status){$(".header-wishlist").find(".dropdown-menu").removeClass("wishlist-login");var checkWLClasshow=$(".header-wishlist").find(".dropdown").children()[0];$(checkWLClasshow).hasClass("show")&&setTimeout(()=>{var secondChildWishlist=$(".header-wishlist").find(".dropdown").children()[1];$(secondChildWishlist).addClass("show")},700),$(".header-wishlist").find(".dropdown-menu").html(data.wishlist),location.reload()}else null!=data.wishlist&&($(".header-wishlist").find(".dropdown-menu").addClass("wishlist-login"),$(".header-wishlist").find(".dropdown").removeClass("owy-wishlist-cart"),$(".header-wishlist").find(".dropdown-menu").html(data.wishlist),location.reload())}))}function changeQty(action,data){$.post(action,data,(function(){}))}$(document).on("click",".btn-link",(function(event){event.preventDefault(),event.stopPropagation(),event.stopImmediatePropagation();var owyLink=$("#owyshopLink").attr("data-shop-url");window.location.replace(owyLink+"/checkout/cart")})),$(document).on("click","#owy-remove",(function(){var idToRemove=$(this).closest(".line-item-remove-button").data("id"),storedIDs,updatedIDs=JSON.parse(localStorage.getItem("compare-widget-added-products")).filter((function(id){return id!==idToRemove}));localStorage.setItem("compare-widget-added-products",JSON.stringify(updatedIDs)),location.reload(),event.stopPropagation()})),$(document).on("click",".deleteWishlist",(function(){const deleteWishlist=$(this).data("delurl"),productId=$(this).data("prdid");var wishlistPrd=$(".product-wishlist-"+productId);$(this).hasClass("deleted")||($(this).addClass("deleted"),$.post(deleteWishlist,(function(data){getWishlist();let wishlistCount=parseInt($("#wishlist-basket").text())-1;$("#wishlist-basket").text(wishlistCount),wishlistPrd.removeClass("product-wishlist-added"),wishlistPrd.addClass("product-wishlist-not-added")})))})),super.init(),$(document).on("click",(function(event){0===$(event.target).closest(".header-cart").length&&$("#new-cart").hasClass("show")&&($("#new-cart").addClass("d-none"),$("#new-cart").removeClass("show"),$("#cart-data").addClass("d-none"))})),$(document).on("click",".header-cart",(function(event){$(".dropdown-menu").hasClass("show")&&$(".dropdown-menu").removeClass("owy-compare-inner-cart show"),event.preventDefault(),event.stopPropagation(),event.stopImmediatePropagation(),$("#new-cart").hasClass("d-none")&&($("#new-cart").removeClass("d-none"),$("#new-cart").addClass("show"),$("#cart-data").removeClass("d-none"))})),!0!==$("body").hasClass("is-ctl-checkout is-act-cartpage")&&$(document).on("click",".line-item-remove-button",(function(event){event.preventDefault(),event.stopPropagation(),event.stopImmediatePropagation();let form=$(this).parent(),action=$(form).attr("action");$.post(action,(function(){}))})),$(document).on("change",".line-item-quantity-container ",(function(event){let action,data;event.preventDefault(),event.stopPropagation(),event.stopImmediatePropagation(),changeQty($(this).attr("action"),$(this).serialize())}))}openOffCanvas(url,data,callback){const isFullwidth=ViewportDetection.isXS();AjaxOffCanvas.open(url,data,this._onOffCanvasOpened.bind(this,callback),this.options.offcanvasPosition,void 0,void 0,isFullwidth),AjaxOffCanvas.setAdditionalClassName(this.options.additionalOffcanvasClass),setTimeout((function(){var cartData=$("body").find(".offcanvas-cart");cartData.length>1&&(cartData=cartData[cartData.length-1]),$(cartData).removeClass("d-none"),$("#cart-data").html(cartData).removeClass("d-none"),0!=data&&$("#new-cart").removeClass("d-none").addClass("show")}),1e3)}}