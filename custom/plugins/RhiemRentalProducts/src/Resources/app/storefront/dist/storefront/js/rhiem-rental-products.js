"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["rhiem-rental-products"],{6744:(t,e,i)=>{var n,r,a,s=i(8248),o=i(2613),l=i.n(o),c=i(8254),u=i(6285);class d extends u.Z{init(){this._createCalendar()}_createCalendar(){this._flatpickr=(0,s.Z)(this.el,{...this.options.flatpickrOptions,...this._getLocale(),minDate:(new Date).fp_incr(this.options.offset),onDayCreate:function(t,e,i,n){let r=n.dateObj;(this.options.blockedWeekdays&&this.options.blockedWeekdays.includes(r.getDay())||this.options.notSelectableDates&&this.options.notSelectableDates.includes(this._dateWithoutTime(r)))&&n.classList.add("notSelectable")}.bind(this),onChange:function(t){if(this.options.fixedPeriod&&t&&1===t.length){let e=[t[0],t[0].fp_incr(this.options.minDuration-1)];this._flatpickr.setDate(e,!1)}if(t&&t.length>1){let e=this._toUTCDate(t[0]),i=this._toUTCDate(t[1]);this._rentDuration=this._getDateDifference(e,i),this.options.minDuration&&this._rentDuration<this.options.minDuration&&this._flatpickr.setDate([t[0],t[0].fp_incr(this.options.minDuration-1)],!0),this.options.maxDuration&&this._rentDuration>this.options.maxDuration&&this._flatpickr.setDate([t[0],t[0].fp_incr(this.options.maxDuration-1)],!0)}}.bind(this)}),this._setCurrentRentalPeriod()}_toUTCDate(t){let e=new Date;return e.setUTCFullYear(t.getFullYear()),e.setUTCMonth(t.getMonth()),e.setUTCDate(t.getDate()),e.setUTCHours(t.getHours()),t}_getDateDifference(t,e,i="day"){let n;switch(i){case"day":n=864e5;break;case"hour":n=36e5;break;default:throw"Unit not supported!"}const r=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate()),a=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate());let s=Math.abs(a-r),o=Math.ceil(s/n)+1;return this.options.removeBlockedDays&&(o-=this._getNotSelectableDatesInRange(t,e)),o}_getLocale(){let t="default";return"en"!==this.options.language.substring(0,2)&&(t=this.options.language.substring(0,2)),{locale:l()[t]}}_setCurrentRentalPeriod(){this.options.currentRentalPeriodStart&&this.options.currentRentalPeriodEnd&&this._flatpickr.setDate(this._getCurrentDates(),!0)}_getCurrentDates(){return[new Date(Date.parse(this.options.currentRentalPeriodStart)),new Date(Date.parse(this.options.currentRentalPeriodEnd))]}_dateWithoutTime(t){return t.getFullYear()+"-"+("0"+(t.getMonth()+1)).slice(-2)+"-"+("0"+t.getDate()).slice(-2)}}n=d,a={offset:0,minDuration:1,maxDuration:730,fixedPeriod:!1,blockedWeekdays:[],notSelectableDates:[],currentRentalPeriodStart:null,currentRentalPeriodEnd:null,language:"en-GB",flatpickrOptions:{mode:"range",dateFormat:"Y-m-dTH:i:S",altInput:!0,altFormat:"d. F Y",enableTime:!1,time_24hr:!0,position:"below",locale:{firstDayOfWeek:1},_notSelectable:[]}},(r=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(r="options"))in n?Object.defineProperty(n,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[r]=a;class h extends d{init(){this.httpClient=new c.Z,this._rentButton=document.getElementById("rent-button"),this._rentQuantity=document.querySelector(".product-detail-quantity-input"),this._createFormatter(),this._getRentData(),this._createCalendar(),this._registerEvents(),this._showTwoPrices()}_registerEvents(){this._rentQuantity.addEventListener("change",this._updateRentalPrice.bind(this)),document.$emitter.subscribe("onCloseOffcanvas",this._reloadRentData.bind(this))}_createCalendar(){this._flatpickr=(0,s.Z)(this.el,{...this.options.flatpickrOptions,...this._getLocale(),minDate:(new Date).fp_incr(this.options.offset),onDayCreate:function(t,e,i,n){let r=n.dateObj;this._dateIsSelectable(r)||n.classList.add("notSelectable")}.bind(this),onChange:function(t){console.log("$(`[data-rental-calendar]`).val():",$("[data-rental-calendar]").val());let e=this,i=!1;if(this.options.currentRentalPeriodStart&&this.options.currentRentalPeriodEnd&&((t=this._getCurrentDates()).forEach((function(t){t<e._flatpickr.config._minDate&&(i=!0)})),i||this._flatpickr.setDate(t,!1)),this.options.fixedPeriod&&t&&1===t.length){let e=[t[0],t[0].fp_incr(this.options.minDuration-1)];this._flatpickr.setDate(e,!1),t=e}if(this.options.currentRentalPeriodStart||this.options.currentRentalPeriodEnd||t.forEach((function(t){e._dateIsSelectable(t)||(i=!0)})),i)e._flatpickr.setDate([],!1);else if(t&&t.length>1){let e=this._toUTCDate(t[0]),i=(this._toUTCDate(t[1]),parseInt(this._rentQuantity.getAttribute("max")));const n=this._parseDateRange();if(this._rentDuration=this._getDateDifference(n[0],n[1]),this._updateRentalPrice(),this._rentsPerDay){let t=e,n=this._dateToIsoString(t);for(let e=0;e<this._rentDuration;e++)void 0!==this._rentsPerDay[n]&&this._rentsPerDay[n].minAvailable<i&&(i=this._rentsPerDay[n].minAvailable),t.setDate(t.getDate()+1),n=this._dateToIsoString(t)}this._rentQuantity.setAttribute("max",i),this._rentQuantity.value>i&&(this._rentQuantity.value=i),i>0&&(this._rentButton.disabled=!1,this._rentQuantity.disabled=!1)}else this._rentButton.disabled=!0,this._rentQuantity.disabled=!0}.bind(this)}),this._setCurrentRentalPeriod()}_reloadRentData(){this._getRentData(),this._flatpickr.clear()}_updateRentalPrice(){if(parseInt(this._rentQuantity.value)>parseInt(this._rentQuantity.getAttribute("max"))&&(this._rentQuantity.value=this._rentQuantity.getAttribute("max")),!this._rentDuration)return;let t=this._getPriceCalcQuantity(this._rentQuantity.value);this._setPrice(this._calculateRentalPrice(this._rentDuration,this._calculateUnitPrice(t),this._rentQuantity.value))}_createFormatter(){this.currencyFormatter=new Intl.NumberFormat(this.options.language,{style:"currency",currency:this.options.currency})}_setPrice(t){document.getElementById("rental-price").innerHTML=this.currencyFormatter.format(t)}_getRentData(){this.httpClient.get(this.options.rentDataUrl,(t=>{let e=JSON.parse(t);this._rentsPerDay=e.rentTimes,this._setBlockedPeriods(e.blockedDays),e.currentRentalPeriods?(this.options.currentRentalPeriodStart=e.currentRentalPeriods.startDate,this.options.currentRentalPeriodEnd=e.currentRentalPeriods.endDate,this._setCurrentRentalPeriod()):(this.options.currentRentalPeriodStart=null,this.options.currentRentalPeriodEnd=null)}))}_setBlockedPeriods(t){t.forEach(((e,i)=>{t[i]=new Date(e)})),this._flatpickr.set("disable",t)}_calculateRentalPrice(t,e,i){return t*e*i}_calculateUnitPrice(t){if(void 0===this.options.productPrices[0])return this.options.productPrice;let e=this.options.productPrices,i=0;if(e.length>1){for(var n=0;n<e.length;n++)if(i=e[n].unitPrice,parseInt(t)<=e[n].quantity)return i}else 1==e.length&&(i=e[0].unitPrice);return i}_getPriceCalcQuantity(t){return 1===parseInt(this.options.productPricesMode)&&(t=isNaN(this._rentDuration)?1:this._rentDuration),t}_toUTCDate(t){return t.setUTCFullYear(t.getFullYear()),t.setUTCMonth(t.getMonth()),t.setUTCDate(t.getDate()),t.setUTCHours(t.getHours()),t}_dateToIsoString(t){let e=t.toISOString();return e=e.substring(0,e.length-5)+"+00:00",e}_getNotSelectableDatesInRange(t,e){let i=new Date(t.getTime()),n=0;for(;this._dateWithoutTime(i)!=this._dateWithoutTime(e);)(this.options.blockedWeekdays.includes(i.getDay())||this.options.notSelectableDates.includes(this._dateWithoutTime(i)))&&n++,i.setDate(i.getDate()+1);return n}_dateIsSelectable(t){return!(this.options.currentRentalPeriodStart&&this.options.currentRentalPeriodEnd||this.options.blockedWeekdays&&this.options.blockedWeekdays.length>0&&this.options.blockedWeekdays.includes(t.getDay())||this.options.notSelectableDates&&this.options.notSelectableDates.length>0&&this.options.notSelectableDates.includes(this._dateWithoutTime(t)))}_parseDateRange(){const t=$("[data-rental-calendar]").val();let e;switch(document.documentElement.lang){case"en-GB":e=" to ";break;case"de-CH":default:e=" bis ";break;case"fr-FR":e=" au "}const i=t.split(e),n=i[0],r=1===i.length?n:i[1];return[new Date(n),new Date(r)]}_showTwoPrices(){$(".product-block-prices-body tr:last-child .product-block-prices-quantity").html(2);const t=$('.product-block-prices-body tr:first-child .product-block-prices-cell meta[itemprop="price"]').attr("content"),e=Math.round(.15*t);$('.product-block-prices-body tr:last-child .product-block-prices-cell meta[itemprop="price"]').attr("content",e),$(".product-block-prices-body tr:last-child  .product-block-prices-cell div").html(this._formatCHF(e)),$(".product-block-prices-body tr:last-child").css("display","table-row")}_formatCHF(t){return new Intl.NumberFormat(document.documentElement.lang,{style:"currency",currency:"CHF",minimumFractionDigits:2,maximumFractionDigits:2}).format(t)}}!function(t,e,i){(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i}(h,"options",{rentDataUrl:null,productPrice:0,productPrices:[],productPricesMode:null,mode:1,offset:0,minDuration:1,maxDuration:730,fixedPeriod:!1,blockedWeekdays:[],notSelectableDates:[],removeBlockedDays:!1,currentRentalPeriodStart:null,currentRentalPeriodEnd:null,language:"en-GB",currency:"EUR",flatpickrOptions:{mode:"range",dateFormat:"Y-m-dTH:i:S",altInput:!0,altFormat:"d. F Y",enableTime:!1,time_24hr:!0,position:"below",inline:!0,locale:{firstDayOfWeek:1},_notSelectable:[]}});const p=window.PluginManager;p.register("RentalCalendar",h,"[data-rental-calendar]"),p.register("DateRange",d,"[data-date-range]")}},t=>{t.O(0,["vendor-node","vendor-shared"],(()=>{return e=6744,t(t.s=e);var e}));t.O()}]);